// Показать меню - десктоп
$(".dropdown-button").each(function () {
	let target = $(this).data("target");
	let dropdown = "#" + target;
	let dropdownState = false;

	function dropdownVisibility() {
		if (dropdownState === false) {
			$(dropdown).slideDown("fast");
			dropdownState = true;
		} else {
			$(dropdown).slideUp("fast");
			dropdownState = false;
		}
	}

	function hideDropdownOnClick() {
		if (dropdownState == true) {
			$(document).mouseup(function (e) {
				if (!$(dropdown).is(e.target) && $(dropdown).has(e.target).length === 0) {
					$(dropdown).slideUp("fast");
				}
			});
		}
	}

	$(document).on("click", '[data-target="' + target + '"]', function () {
		dropdownVisibility();
		hideDropdownOnClick();
	});
});
// Главный поиск
$(document).ready(function () {
	const date = ["Киев", "Харьков", "Днепропетровск", "Лисичанск", "Донецк", "Северодонецк", "Рубежное", "Луганск"];
	$("#search").autocomplete({
		source: date,
	});
});

// Второй поиск
$(document).ready(function () {
	const date = ["Киев", "Харьков", "Днепропетровск", "Лисичанск", "Донецк", "Северодонецк", "Рубежное", "Луганск"];
	$("#search-second").autocomplete({
		source: date,
	});
});
$(".menu li a[menu-open]").hover(
	function () {
		$(this).parent().parent().parent().next().show();
	},
	function () {}
);

$(".menu-level-first").hover(function () {
	$(".menu-level-third").hide();
});

$(".menu-level-second").click(function (e) {
	if (e.target == $(this).children().children().find("a")) {
	} else {
		$(".menu-level-third").hide();
	}
});

$(".menu-level-first").click(function (e) {
	if (e.target == $(this).children().children().find("a")) {
	} else {
		$(".menu-level-second").hide();
	}
});
// Открыть / закрыть мобильное меню
$(document).ready(function () {
	const mobileNav = $("#mobile-nav-397");
	const body = $("#body");
	$("#mobile-nav-397-open").click(function () {
		mobileNav.show();
		$(body).css("overflow", "hidden");
	});
	$("#mobile-nav-397-close").click(function () {
		mobileNav.hide();
		$(body).css("overflow", "auto");
	});
});

// Открыть многоуровневое меню
$(document).ready(function () {
	$("#allSectionButton").click(function () {
		$("#allSections").show();
	});
});

// Многоуровневое мобильное меню
$(document).ready(function () {
	$(".mobMenuFirst button").click(function () {
		$(this).parent().parent().hide();
		$(".mobMenuSecond").show();
	});

	$(".mobMenuSecond button").click(function () {
		$(this).parent().parent().hide();
		$(".mobMenuThird").show();
	});

	$(".mobMenuThird button").click(function () {
		$(this).parent().parent().hide();
		$(".mobMenuFour").show();
	});

	$(".button-back").click(function () {
		$(this).parent().hide();
		$(this).parent().prev().show();
	});

	$("#mobile-nav-398-close").click(function () {
		$(this).parent().parent().hide();
	});
});
// Показать/скрыть пароль
$(document).ready(function () {
	$(".password-control").click(function () {
		var passwordInput = $(this).prev();
		if (passwordInput.attr("type") == "password") {
			$(this).addClass("password-control--active");
			passwordInput.attr("type", "text");
		} else {
			$(this).removeClass("password-control--active");
			passwordInput.attr("type", "password");
		}
		return false;
	});
});
Dropzone.options.dropzone = {
	maxFilesize: 2,
};
Dropzone.prototype.defaultOptions.dictDefaultMessage = "Нажмите или перетащите сюда изображение для загрузки.";
Dropzone.prototype.defaultOptions.dictFallbackMessage = "Ваш браузер не поддерживает загрузку файлов перетаскиванием.";
Dropzone.prototype.defaultOptions.dictFileTooBig = "Изображение слишком большое ({{filesize}}МБ). Максимальный размер: {{maxFilesize}}МБ.";
Dropzone.prototype.defaultOptions.dictInvalidFileType = "Вы не можете загружать файлы этого типа.";
Dropzone.prototype.defaultOptions.dictResponseError = "Server responded with {{statusCode}} code.";
Dropzone.prototype.defaultOptions.dictCancelUpload = "Отменить загрузку";
Dropzone.prototype.defaultOptions.dictCancelUploadConfirmation = "Вы уверены, что хотите отменить эту загрузку?";
Dropzone.prototype.defaultOptions.dictRemoveFile = "Удалить файл";
Dropzone.prototype.defaultOptions.dictMaxFilesExceeded = "Вы не можете больше загружать файлы.";

$(document).ready(function () {
	$("#select-type").select2({
		placeholder: "Выберите тип эвакуатора",
		multiple: false,
		minimumResultsForSearch: Infinity,
	});
	$("#carrying-capacity").select2({
		placeholder: "Выберите грузоподъемность эвакуатора",
		multiple: false,
		minimumResultsForSearch: Infinity,
	});
	$("#region").select2({
		placeholder: "Где находится эвакуатор?",
		multiple: false,
		minimumResultsForSearch: Infinity,
	});
	$("#city").select2({
		placeholder: "",
		multiple: false,
		minimumResultsForSearch: Infinity,
	});
	// Добавить объявление
	$("#region-objavlenie").select2({
		multiple: false,
		minimumResultsForSearch: Infinity,
	});
	$("#select-type-objavlenie").select2({
		multiple: false,
		minimumResultsForSearch: Infinity,
	});
	$("#city-objavlenie").select2({
		multiple: false,
		minimumResultsForSearch: Infinity,
	});
	$(".default-select2").select2({
		multiple: false,
		minimumResultsForSearch: Infinity,
	});
});
$(document).ready(function () {
	$("#showPhones").click(function () {
		$("#additionalPhones").slideDown();
		$("#additionalPhonesQuestion").slideUp();
	});
});
// Селекты в фильтрах
$(document).ready(function () {
	// Показать селекты
	$("#showFilter").click(function () {
		$(".filters").slideToggle();
		$(this).find(".show-filter-arrow").toggleClass("-rotate-90");
		$(this).find("span").toggleClass("text-accent");
	});
	// Инициализировать селекты
	$(".filters .select").select2({
		multiple: true,
		minimumResultsForSearch: Infinity,
	});
});
$(document).ready(function () {
	if ($("#popup").length === 1) {
		let popup = document.getElementById("popup");
		let popupCloseButton = popup.querySelector(".button--close");

		function showPopup() {
			popup.classList.remove("hidden");
		}
		function hidePopup() {
			popup.classList.add("hidden");
		}
		function removeImg() {
			$(".popup__img").remove();
		}

		popup.addEventListener("click", (e) => {
			if (e.target === popup) {
				hidePopup();
				removeImg();
			}
		});

		popupCloseButton.addEventListener("click", () => {
			hidePopup();
			removeImg();
		});

		document.addEventListener("keydown", (e) => {
			if (e.code === "Escape" && popup.classList.contains("flex")) {
				hidePopup();
				removeImg();
			}
		});
	}
});

$(document).ready(function () {
	if ($("#complainPopup").length === 1) {
		let complainPopup = document.getElementById("complainPopup");
		let openComplainPopup = document.getElementById("complainButton");
		let closeComplainPopup = complainPopup.querySelector(".button--close");
		let body = $("#body");
		openComplainPopup.addEventListener("click", function () {
			complainPopup.classList.remove("hidden");
			body.css("overflow", "hidden");
		});

		closeComplainPopup.addEventListener("click", function () {
			complainPopup.classList.add("hidden");
			body.css("overflow", "auto");
		});
	}
});

// Скрипт для открытия универсального попапа
$(document).on("click", ".popup--open", function () {
	let modalObj = $("#" + $(this).attr("data-target"));

	// hide other windows
	let openedObj = $(".modalWindow:visible");
	if (openedObj) {
		$(openedObj).hide();
	}

	$(modalObj).show(0, function (e) {
		$("#body").css({ overflow: "hidden" });
		$(modalObj).focus();
	});

	$(document).on("keyup", function (e) {
		if (e.keyCode == 27) {
			$(modalObj).hide();
		}
		$(document).off(this);
	});

	$(modalObj).on("click", function (e) {
		if (e.target.id === modalObj.attr("id") || e.target.classList.contains("modalClose") || $(e.target).parents(".modalClose").length) {
			$("#body").css({ overflow: "" });
			$(modalObj).hide();
			$(modalObj).off("click");
		}
	});
});
let fakeButtonMob = $(".fake-button");
let wrapperTabsMob = $(".tabs-mobile__wrapper");
let arrowMob = $(".tabs-mobile__arrow");

fakeButtonMob.click(function () {
	wrapperTabsMob.toggleClass("h-[37px]");
	arrowMob.toggleClass("rotate-180");
});

let tabLink = $(".tab-content-btn");
let tabContent = $(".tab-content-block");

tabLink.click(function () {
	let that = $(this);
	let idContent = "#" + that.data("target");

	tabLink.removeClass("tab-content-btn--active");
	that.addClass("tab-content-btn--active");

	tabContent.hide();
	$(idContent).show();
});